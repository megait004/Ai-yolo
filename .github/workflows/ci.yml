deploy:
    runs-on: ubuntu-latest
    needs: [build, security-scan]
    if: startsWith(github.ref, 'refs/tags/')

    steps:
        - uses: actions/checkout@v4

        - name: Download build artifacts
          uses: actions/download-artifact@v4
          with:
              name: dist
              path: dist/

        - name: Create GitHub Release
          uses: softprops/action-gh-release@v2
          with:
              tag_name: ${{ github.ref_name }}
              name: Release ${{ github.ref_name }}
              draft: false
              prerelease: false
              files: |
                  dist/*.whl
                  dist/*.tar.gz

        - name: Set up Python 3.10
          uses: actions/setup-python@v5
          with:
              python-version: '3.10'

        - name: Upload to PyPI
          env:
              TWINE_USERNAME: ${{ secrets.PYPI_USERNAME }}
              TWINE_PASSWORD: ${{ secrets.PYPI_PASSWORD }}
          run: |
              python -m pip install --upgrade pip
              pip install twine
              twine upload dist/* --non-interactive
